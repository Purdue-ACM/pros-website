

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Iterative and Async Controllers &mdash; PROS for V5 3.1.1 documentation</title>
  

  
  
    <link rel="shortcut icon" href="../../../_static/favicon.ico"/>
  
  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
  

<link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />

  

  
        <link rel="index" title="Index"
              href="../../../genindex.html"/>
        <link rel="search" title="Search" href="../../../search.html"/>
    <link rel="top" title="PROS for V5 3.1.1 documentation" href="../../../index.html"/>
        <link rel="up" title="Tutorials" href="../index.html"/>
        <link rel="next" title="SettledUtils" href="settled-util.html"/>
        <link rel="prev" title="Filtering" href="filtering.html"/>
  
   
  
  
  <style type="text/css">
    ul.ablog-archive {list-style: none; overflow: auto; margin-left: 0px}
    ul.ablog-archive li {float: left; margin-right: 5px; font-size: 80%}
    ul.postlist a {font-style: italic;}
    ul.postlist-style-disc {list-style-type: disc;}
    ul.postlist-style-none {list-style-type: none;}
    ul.postlist-style-circle {list-style-type: circle;}
  </style>


  
  <script src="../../../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../../../index.html" class="icon icon-home"> PROS for V5
          

          
            
            <img src="../../../_static/logo.svg" class="logo" />
          
          </a>

          
            
            
              <div class="version">
                
                  V5 (3.1.1)
                
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Home</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../index.html">PROS: Documentation Home</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../blog/index.html">Blog</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../releases/index.html">Version Release Notes</a></li>
</ul>
<p class="caption"><span class="caption-text">Getting Started</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../getting-started/index.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../getting-started/new-users.html">PROS First Time Users Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../getting-started/installation.html">Installation Guides</a></li>
</ul>
<p class="caption"><span class="caption-text">Tutorials</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../tutorials/index.html">Tutorials</a></li>
</ul>
<p class="caption"><span class="caption-text">API</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../api/index.html">API Home</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../api/c/index.html">C API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../api/cpp/index.html">C++ API</a></li>
</ul>
<p class="caption"><span class="caption-text">Tools</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../cli/index.html">CLI</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../editor/index.html">Editor</a></li>
</ul>
<p class="caption"><span class="caption-text">OkapiLib</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="../../index.html">OkapiLib Documentation Home</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../../api/index.html">OkapiLib API</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../index.html">Tutorials</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="../index.html#walkthrough-tutorials">Walkthrough Tutorials</a></li>
<li class="toctree-l3 current"><a class="reference internal" href="../index.html#topical-tutorials">Topical Tutorials</a><ul class="current">
<li class="toctree-l4"><a class="reference internal" href="2dmotionprofiling.html">2D Motion Profiling</a></li>
<li class="toctree-l4"><a class="reference internal" href="chassiscontroller.html">What is a ChassisController, and why is it important?</a></li>
<li class="toctree-l4"><a class="reference internal" href="controller-io.html">Controller Inputs and Outputs</a></li>
<li class="toctree-l4"><a class="reference internal" href="factories.html">Factory Object Creation Pattern</a></li>
<li class="toctree-l4"><a class="reference internal" href="filtering.html">Filtering</a></li>
<li class="toctree-l4 current"><a class="current reference internal" href="#">Iterative and Async Controllers</a><ul>
<li class="toctree-l5"><a class="reference internal" href="#iterative-controllers">Iterative Controllers</a></li>
<li class="toctree-l5"><a class="reference internal" href="#async-controllers">Async Controllers</a></li>
<li class="toctree-l5"><a class="reference internal" href="#when-should-i-use-which-controller">When Should I Use Which Controller?</a></li>
</ul>
</li>
<li class="toctree-l4"><a class="reference internal" href="settled-util.html">SettledUtils</a></li>
<li class="toctree-l4"><a class="reference internal" href="smart-pointers.html">Smart Pointers</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">Tutorials</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../index.html#walkthrough-tutorials">Walkthrough Tutorials</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../index.html#topical-tutorials">Topical Tutorials</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="2dmotionprofiling.html">2D Motion Profiling</a></li>
<li class="toctree-l3"><a class="reference internal" href="chassiscontroller.html">What is a ChassisController, and why is it important?</a></li>
<li class="toctree-l3"><a class="reference internal" href="controller-io.html">Controller Inputs and Outputs</a></li>
<li class="toctree-l3"><a class="reference internal" href="factories.html">Factory Object Creation Pattern</a></li>
<li class="toctree-l3"><a class="reference internal" href="filtering.html">Filtering</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">Iterative and Async Controllers</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#iterative-controllers">Iterative Controllers</a></li>
<li class="toctree-l4"><a class="reference internal" href="#async-controllers">Async Controllers</a></li>
<li class="toctree-l4"><a class="reference internal" href="#when-should-i-use-which-controller">When Should I Use Which Controller?</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="settled-util.html">SettledUtils</a></li>
<li class="toctree-l3"><a class="reference internal" href="smart-pointers.html">Smart Pointers</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../api/index.html">OkapiLib API</a></li>
</ul>
<p class="caption"><span class="caption-text">Extended (Advanced Users)</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../extended/index.html">Extended API Topics</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">PROS for V5</a>
        
      </nav>


      <div class="wy-nav-content">
        <div class="rst-content">
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../../index.html">OkapiLib Documentation Home</a> &raquo;</li>
        
          <li><a href="../index.html">Tutorials</a> &raquo;</li>
        
      <li>Iterative and Async Controllers</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            
              <a href="https://github.com/purduesigbots/pros-docs/blob/master/v5/okapi/tutorials/concepts/iterative-async-controllers.rst" class="fa fa-github"> Edit on GitHub</a>
            
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="iterative-and-async-controllers">
<h1>Iterative and Async Controllers<a class="headerlink" href="#iterative-and-async-controllers" title="Permalink to this headline">¶</a></h1>
<p>OkapiLib provides two main types of feedback controllers, <strong>Iterative Controllers</strong> and <strong>Async Controllers</strong>.
The two both accomplish the same end goal – controlling a given system – but in different manners that makes
them tailored for different applications. You can achieve the same response from a system with either option,
but one will likely be better than the other for your particular preference with code organization.</p>
<div class="section" id="iterative-controllers">
<h2>Iterative Controllers<a class="headerlink" href="#iterative-controllers" title="Permalink to this headline">¶</a></h2>
<p><strong>Iterative Controllers</strong> operate <strong>discretely</strong>, meaning that an Iterative Controller will produce an output for the
given input <em>at a single point in time</em>
(see <a class="reference external" href="../../api/control/iterative/abstract-iterative-controller.html#step">IterativeController::step()</a>).
If you want to execute a full movement for a system with an Iterative Controller,
you will need to write a loop that runs <code class="docutils literal notranslate"><span class="pre">IterativeController::step()</span></code> repeatedly until the movement is finished.</p>
<p>An example movement:</p>
<div class="highlight-cpp notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">using</span> <span class="k">namespace</span> <span class="n">okapi</span><span class="p">;</span>

<span class="k">const</span> <span class="kt">double</span> <span class="n">kP</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">;</span>
<span class="k">const</span> <span class="kt">double</span> <span class="n">kI</span> <span class="o">=</span> <span class="mf">0.001</span><span class="p">;</span>
<span class="k">const</span> <span class="kt">double</span> <span class="n">kD</span> <span class="o">=</span> <span class="mf">0.1</span><span class="p">;</span>
<span class="k">const</span> <span class="kt">int</span> <span class="n">MOTOR_PORT</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
<span class="k">const</span> <span class="kt">double</span> <span class="n">TARGET</span> <span class="o">=</span> <span class="mf">100.0</span><span class="p">;</span>

<span class="k">auto</span> <span class="n">exampleController</span> <span class="o">=</span> <span class="n">IterativeControllerFactory</span><span class="o">::</span><span class="n">posPID</span><span class="p">(</span><span class="n">kP</span><span class="p">,</span> <span class="n">kI</span><span class="p">,</span> <span class="n">kD</span><span class="p">);</span>
<span class="n">Motor</span> <span class="nf">exampleMotor</span><span class="p">(</span><span class="n">MOTOR_PORT</span><span class="p">);</span>

<span class="c1">// Execute the movement</span>
<span class="n">exampleController</span><span class="p">.</span><span class="n">setTarget</span><span class="p">(</span><span class="n">TARGET</span><span class="p">);</span>
<span class="k">while</span> <span class="p">(</span><span class="o">!</span><span class="n">exampleController</span><span class="p">.</span><span class="n">isSettled</span><span class="p">())</span> <span class="p">{</span>
  <span class="kt">double</span> <span class="n">newInput</span> <span class="o">=</span> <span class="n">exampleMotor</span><span class="p">.</span><span class="n">getPosition</span><span class="p">();</span>
  <span class="kt">double</span> <span class="n">newOutput</span> <span class="o">=</span> <span class="n">exampleController</span><span class="p">.</span><span class="n">step</span><span class="p">(</span><span class="n">newInput</span><span class="p">);</span>
  <span class="n">exampleMotor</span><span class="p">.</span><span class="n">controllerSet</span><span class="p">(</span><span class="n">newOutput</span><span class="p">);</span>

  <span class="n">pros</span><span class="o">::</span><span class="n">delay</span><span class="p">(</span><span class="mi">10</span><span class="p">);</span> <span class="c1">// Run the control loop at 10ms intervals</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="section" id="async-controllers">
<h2>Async Controllers<a class="headerlink" href="#async-controllers" title="Permalink to this headline">¶</a></h2>
<p><strong>Async Controllers</strong> were given their name because they can operate <strong>asynchronously</strong> to one another,
which means practically that you can have multiple movements by multiple controllers operating at the same time easily.
Each Async Controller operates in its own task, so starting a movement for one Async Controller won’t prevent another
Async Controller (or Iterative Controller) from running immediately thereafter.</p>
<p>You don’t need to run a loop to generate and set the controller output like with an Iterative Controller, and blocking further
movements until an Async Controller’s movement is done is as simple as a call to <code class="docutils literal notranslate"><span class="pre">AsyncController::waitUntilSettled()</span></code>.</p>
<p>An example movement:</p>
<div class="highlight-cpp notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">using</span> <span class="k">namespace</span> <span class="n">okapi</span><span class="p">;</span>

<span class="k">const</span> <span class="kt">double</span> <span class="n">kP</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">;</span>
<span class="k">const</span> <span class="kt">double</span> <span class="n">kI</span> <span class="o">=</span> <span class="mf">0.001</span><span class="p">;</span>
<span class="k">const</span> <span class="kt">double</span> <span class="n">kD</span> <span class="o">=</span> <span class="mf">0.1</span><span class="p">;</span>
<span class="k">const</span> <span class="kt">int</span> <span class="n">MOTOR_PORT</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
<span class="k">const</span> <span class="kt">double</span> <span class="n">TARGET</span> <span class="o">=</span> <span class="mf">100.0</span><span class="p">;</span>

<span class="k">auto</span> <span class="n">exampleController</span> <span class="o">=</span> <span class="n">AsyncControllerFactory</span><span class="o">::</span><span class="n">posPID</span><span class="p">(</span><span class="n">MOTOR_PORT</span><span class="p">,</span> <span class="n">kP</span><span class="p">,</span> <span class="n">kI</span><span class="p">,</span> <span class="n">kD</span><span class="p">);</span>

<span class="c1">// Execute the movement</span>
<span class="n">exampleController</span><span class="p">.</span><span class="n">setTarget</span><span class="p">(</span><span class="n">TARGET</span><span class="p">);</span>
<span class="n">exampleController</span><span class="p">.</span><span class="n">waitUntilSettled</span><span class="p">();</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="section" id="when-should-i-use-which-controller">
<h2>When Should I Use Which Controller?<a class="headerlink" href="#when-should-i-use-which-controller" title="Permalink to this headline">¶</a></h2>
<p>Async Controllers are obviously the easiest to work with for normal movements, as seen in the above example code.
If you just want to run a system or systems in the manner shown in the examples, that’s probably your best choice.
If you want to collect extra data during the movement (such as motor stats like current, temperature, etc.), then you
will need to use an Iterative Controller to collect that data. Additionally, if you want to use the output from
two controllers to set the output for your system (i.e. running both a heading PID and a forward/backward PID on
a drivetrain), the using two Iterative Controllers would be the best idea.</p>
<p>To conclude, for most applications an Async Controller should suffice, but if you want more complex behavior, then use
an Iterative Controller.</p>
</div>
</div>

  <div class="section">
  
  
  </div>

           </div>
           <div class="articleComments">
            
           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="settled-util.html" class="btn btn-neutral float-right" title="SettledUtils" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="filtering.html" class="btn btn-neutral" title="Filtering" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2018, Purdue ACM SIGBots. Released under the MPL 2.0 license

    </p>
  </div> 

</footer>

        </div>
      </div>

    </section>

  </div>
  

  <div class="rst-versions" data-toggle="rst-versions" role="note" aria-label="versions">
    <span class="rst-current-version" data-toggle="rst-current-version">
      <span class="fa fa-book"> Versions: </span>
      v: V5 (3.1.1)
      <span class="fa fa-caret-down"></span>
    </span>
    <div class="rst-other-versions">
      <dl>
        <dt>Versions</dt>
        
          <dd><a href="../../../index.html">V5</a></dd>
        
          <dd><a href="../../../../cortex/index.html">Cortex</a></dd>
        
      </dl>
    </div>
  </div>


  

    
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../../" src="../../../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../../../_static/jquery.js"></script>
        <script type="text/javascript" src="../../../_static/underscore.js"></script>
        <script type="text/javascript" src="../../../_static/doctools.js"></script>
        <script async="async" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    

  

  <script type="text/javascript" src="../../../_static/js/theme.js"></script>

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
  
 
<script type="text/javascript">
var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
</script>
<script type="text/javascript">
try {
var pageTracker = _gat._getTracker("UA-84548828-3");
pageTracker._trackPageview();
} catch(err) {}</script>


</body>
</html>