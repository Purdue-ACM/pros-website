

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Clawbot Tutorial &mdash; PROS for Cortex 2.12.1 documentation</title>
  

  
  
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
  
  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  

<link rel="stylesheet" href="../_static/pygments.css" type="text/css" />

  

  
        <link rel="index" title="Index"
              href="../genindex.html"/>
        <link rel="search" title="Search" href="../search.html"/>
    <link rel="top" title="PROS for Cortex 2.12.1 documentation" href="../index.html"/>
        <link rel="up" title="Tutorials" href="index.html"/>
        <link rel="next" title="Coding FAQ" href="coding-faq.html"/>
        <link rel="prev" title="Analog Sensors" href="analog.html"/> 

  
  <script src="../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../index.html" class="icon icon-home"> PROS for Cortex
          

          
            
            <img src="../_static/logo.svg" class="logo" />
          
          </a>

          
            
            
              <div class="version">
                
                  Cortex (2.12.1)
                
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Home</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../index.html">PROS: Documentation Home</a></li>
</ul>
<p class="caption"><span class="caption-text">Getting Started</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../getting-started/index.html">Getting Started</a></li>
</ul>
<p class="caption"><span class="caption-text">Tutorials</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Tutorials</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="analog.html">Analog Sensors</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Clawbot Tutorial</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#objective">Objective:</a></li>
<li class="toctree-l3"><a class="reference internal" href="#intended-audience">Intended Audience:</a></li>
<li class="toctree-l3"><a class="reference internal" href="#goals">Goals:</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#pros-project-structure">PROS Project Structure</a></li>
<li class="toctree-l4"><a class="reference internal" href="#arcade-control">Arcade Control</a></li>
<li class="toctree-l4"><a class="reference internal" href="#compilation">Compilation</a></li>
<li class="toctree-l4"><a class="reference internal" href="#uploading-code-to-the-cortex">Uploading Code to the Cortex</a></li>
<li class="toctree-l4"><a class="reference internal" href="#subsystem-module-methodology">Subsystem Module Methodology</a></li>
<li class="toctree-l4"><a class="reference internal" href="#programming-the-vex-claw">Programming the VEX Claw</a></li>
<li class="toctree-l4"><a class="reference internal" href="#controlling-the-lift">Controlling the Lift</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="coding-faq.html">Coding FAQ</a></li>
<li class="toctree-l2"><a class="reference internal" href="debugging.html">Debugging</a></li>
<li class="toctree-l2"><a class="reference internal" href="digitalRead.html">Digital Sensors</a></li>
<li class="toctree-l2"><a class="reference internal" href="encoders.html">Encoders</a></li>
<li class="toctree-l2"><a class="reference internal" href="i2c.html">I2C</a></li>
<li class="toctree-l2"><a class="reference internal" href="jinx.html">JINX Debugger</a></li>
<li class="toctree-l2"><a class="reference internal" href="known-issues.html">Known Issues</a></li>
<li class="toctree-l2"><a class="reference internal" href="lcd.html">LCD</a></li>
<li class="toctree-l2"><a class="reference internal" href="libraries.html">Libraries</a></li>
<li class="toctree-l2"><a class="reference internal" href="pneumatics.html">Pneumatics</a></li>
<li class="toctree-l2"><a class="reference internal" href="project-structure.html">Project Structure</a></li>
<li class="toctree-l2"><a class="reference internal" href="speaker.html">Speaker</a></li>
<li class="toctree-l2"><a class="reference internal" href="tasks.html">Tasks</a></li>
<li class="toctree-l2"><a class="reference internal" href="ultrasonic.html">Ultrasonics</a></li>
<li class="toctree-l2"><a class="reference internal" href="upgrading.html">Upgrading PROS</a></li>
<li class="toctree-l2"><a class="reference internal" href="uploading.html">Uploading</a></li>
</ul>
</li>
</ul>
<p class="caption"><span class="caption-text">API</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../api/index.html">API</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">PROS for Cortex</a>
        
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
          <li><a href="index.html">Tutorials</a> &raquo;</li>
        
      <li>Clawbot Tutorial</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            
              <a href="https://github.com/purduesigbots/pros-docs/blob/master/cortex/tutorials/clawbot.rst" class="fa fa-github"> Edit on GitHub</a>
            
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="clawbot-tutorial">
<h1>Clawbot Tutorial<a class="headerlink" href="#clawbot-tutorial" title="Permalink to this headline">¶</a></h1>
<div class="section" id="objective">
<h2>Objective:<a class="headerlink" href="#objective" title="Permalink to this headline">¶</a></h2>
<p>This tutorial will guide you through basic programming of the VEX
Clawbot.</p>
</div>
<div class="section" id="intended-audience">
<h2>Intended Audience:<a class="headerlink" href="#intended-audience" title="Permalink to this headline">¶</a></h2>
<p>This tutorial is intended for developers with some programming
experience, but with little to no experience with the PROS library. If
you haven’t programmed before, we recommend checking out all the
“Introduction and Basic C Features” sections of <a class="reference external" href="http://www.studytonight.com/c/overview-of-c.php">this tutorial
series</a>; you may also
benefit from the “Pointers, Arrays and Strings” sections as well
(although they aren’t as pertinent).</p>
</div>
<div class="section" id="goals">
<h2>Goals:<a class="headerlink" href="#goals" title="Permalink to this headline">¶</a></h2>
<p>At the end of this tutorial you will have:</p>
<ul class="simple">
<li>Understood the basic project structure of PROS</li>
<li>Programmed a basic chassis with “tank” control or “arcade” control</li>
<li>Programmed buttons to control the clawbot’s lift</li>
<li>Programmed a joystick axis to control the clawbot’s claw</li>
<li>Understood the standard subsystem module methodology</li>
<li>Programmed a dead-reckoned autonomous routine</li>
</ul>
<p>Here’s the robot we’ll be programming:</p>
<img alt="../_images/clawbot1.jpg" src="../_images/clawbot1.jpg" />
<p>For the purposes of this tutorial, we’ve plugged in our motors into the
following ports:</p>
<table border="1" class="docutils">
<colgroup>
<col width="17%" />
<col width="34%" />
<col width="17%" />
<col width="32%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Port</th>
<th class="head">Description</th>
<th class="head">Port</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>1</td>
<td>&#160;</td>
<td>6</td>
<td>&#160;</td>
</tr>
<tr class="row-odd"><td>2</td>
<td>Left wheels</td>
<td>7</td>
<td>&#160;</td>
</tr>
<tr class="row-even"><td>3</td>
<td>Right wheels</td>
<td>8</td>
<td>Lift</td>
</tr>
<tr class="row-odd"><td>4</td>
<td>&#160;</td>
<td>9</td>
<td>Claw</td>
</tr>
<tr class="row-even"><td>5</td>
<td>&#160;</td>
<td>10</td>
<td>&#160;</td>
</tr>
</tbody>
</table>
<p>We modified our clawbot to include a quadrature encoder on the lift arm.
We plugged the top and bottom ports into digital ports 2 and 3,
respectively.</p>
<p>With Atom started, you can create a new PROS project by clicking the
<code class="docutils literal notranslate"><span class="pre">PROS</span></code> menu, then click <code class="docutils literal notranslate"><span class="pre">Create</span> <span class="pre">new</span> <span class="pre">Project</span></code>.</p>
<img alt="../_images/menu-create-new.png" src="../_images/menu-create-new.png" />
<p>Create a directory that you’d like to keep the source files for your
Clawbot project. We’re creating ours in <code class="docutils literal notranslate"><span class="pre">C:\Users\Elliot\dev\Clawbot</span></code>.</p>
<img alt="../_images/window-create-new.png" src="../_images/window-create-new.png" />
<p>Pick a directory to create the new project in and click Create. The PROS
CLI will now copy the latest kernel template into the specified
directory and Atom will open it.</p>
<img alt="../_images/proj-brand-new.png" src="../_images/proj-brand-new.png" />
<div class="section" id="pros-project-structure">
<h3>PROS Project Structure<a class="headerlink" href="#pros-project-structure" title="Permalink to this headline">¶</a></h3>
<p>When you create your project, PROS will copy all of the files necessary
to build your project. The structure of the project looks like:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>project
│   project.pros        (used by PROS CLI to know kernel version and other metadata)
│   Makefile            (instructs make how to compile your project)
|   common.mk           (helper file for Makefile)
│
└───src                 (source files should go here)
│   │   auto.c          (source for autonomous function)
│   │   init.c          (source for initialization)
│   │   opcontrol.c     (source for operator control)
│   │   Makefile        (instructs make how to compile your source files)
|
└───include             (Header files should go in here)
│   │   API.h           (Lets source files know PROS API functions)
│   │   main.h          (Includes API.h and anything else you want to include project-wide)
│
└───firmware
    │   cortex.ld       (Instructs the linker how to construct binaries for the Cortex)
    │   libpros.a       (Pre-compiled PROS library)
    |   STM32F10x.ld    (Instructs the linker how to construct binaries for the Cortex)
    |   uniflash.jar    (Legacy flashing utility built w/Java)
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">By convention, the <code class="docutils literal notranslate"><span class="pre">opcontrol()</span></code>, <code class="docutils literal notranslate"><span class="pre">autonomous()</span></code>, and initialize functions are separated into separate files (opcontrol.c, auto.c, and init.c). They could be all in the same file, but it can be helpful to organize your functions into multiple files to keep things from becoming messy.</p>
</div>
</div>
<div class="section" id="arcade-control">
<h3>Arcade Control<a class="headerlink" href="#arcade-control" title="Permalink to this headline">¶</a></h3>
<p>Let’s begin by writing a basic “arcade” control for the clawbot. In
arcade control, the vertical joystick values control the
forward/backward speed of the robot and the horizontal joystick values
control the rotation of the robot. Atom will open <code class="docutils literal notranslate"><span class="pre">src/opcontrol.c</span></code>
for you when you create a project, but if it is not open then you will
need to open it by navigating the directory tree on the left panel.</p>
<p>The template <code class="docutils literal notranslate"><span class="pre">opcontrol.c</span></code> file contains a simple infinite loop and
documentation to help remind you what <code class="docutils literal notranslate"><span class="pre">opcontrol()</span></code> does.</p>
<p>PROS offers functions to perform common tasks associated with
programming robotics. To program basic arcade functionality, we need to
be aware of two functions: one to get the joystick input and one to set
the motors to a speed.</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="kt">int</span> <span class="nf">joystickGetAnalog</span> <span class="p">(</span> <span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">joystick</span><span class="p">,</span>   <span class="o">//</span> <span class="n">the</span> <span class="n">joystick</span> <span class="n">slot</span> <span class="n">to</span> <span class="n">check</span> <span class="p">(</span><span class="mi">1</span> <span class="k">for</span> <span class="n">master</span><span class="p">,</span> <span class="mi">2</span> <span class="k">for</span> <span class="n">partner</span><span class="p">)</span>
                        <span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">axis</span>        <span class="c1">// One of the joystick channels on a VEX Joystick: 1, 2, 3, 4, ACCEL_X, or ACCEL_Y</span>
                      <span class="p">);</span>
</pre></div>
</div>
<p>Gets the value of a control axis on the VEX joystick. <strong>*Returns</strong> the
value from -127 to 127, or 0 if no joystick is connected to the
requested slot.s</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="kt">void</span> <span class="nf">motorSet</span> <span class="p">(</span> <span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">channel</span><span class="p">,</span>  <span class="c1">// motor channel to set from 1-10</span>
                <span class="kt">int</span> <span class="n">speed</span>               <span class="c1">// new signed speed. -127 is full reverse, 127 full forward, 0 off</span>
              <span class="p">);</span>
</pre></div>
</div>
<p>Sets the speed of the specified motor channel.</p>
<p>Armed with knowledge of these functions, let’s modify <code class="docutils literal notranslate"><span class="pre">opcontrol()</span></code>:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="kt">void</span> <span class="nf">operatorControl</span><span class="p">()</span> <span class="p">{</span>
  <span class="kt">int</span> <span class="n">power</span><span class="p">;</span>
  <span class="kt">int</span> <span class="n">turn</span><span class="p">;</span>
    <span class="k">while</span> <span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">power</span> <span class="o">=</span> <span class="n">joystickGetAnalog</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span> <span class="c1">// vertical axis on left joystick</span>
        <span class="n">turn</span>  <span class="o">=</span> <span class="n">joystickGetAnalog</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span> <span class="c1">// horizontal axis on left joystick</span>
        <span class="n">motorSet</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">power</span> <span class="o">+</span> <span class="n">turn</span><span class="p">);</span> <span class="c1">// set left wheels</span>
        <span class="n">motorSet</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="n">power</span> <span class="o">-</span> <span class="n">turn</span><span class="p">);</span> <span class="c1">// set right wheels</span>
        <span class="n">delay</span><span class="p">(</span><span class="mi">20</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>It’s considered good practice to comment your code.
Commenting can make it easier to understand the original intention of code
when you have to look back on it months later in the middle of the competition
and everything’s broken.</p>
<p class="last">Your code should tell the story of what you are doing; your comments
should tell the story of why you are doing it. <em>(Source:
http://stackoverflow.com/a/142869)</em></p>
</div>
</div>
<div class="section" id="compilation">
<h3>Compilation<a class="headerlink" href="#compilation" title="Permalink to this headline">¶</a></h3>
<p>Next, you will need to <strong>compile</strong> your project. Compilation converts
your code into instructions the Cortex can understand. There are
typically four stages to compilation. The following paragraphs explain
abstract complicated technical systems. This introduction to compilation
is intended to give some justification for the compilation process, but
is by no means complete. <strong>This information is not necessary to program
with PROS, but may be helpful for some.</strong></p>
<ol class="arabic simple">
<li>Preprocessing</li>
</ol>
<p>Lines starting with a <code class="docutils literal notranslate"><span class="pre">#</span></code> are interpreted by the preprocessor as
commands. These commands can include other pieces of files
(<code class="docutils literal notranslate"><span class="pre">#include</span></code>), execute basic macro logic (<code class="docutils literal notranslate"><span class="pre">#ifdef</span></code>), replace text
(<code class="docutils literal notranslate"><span class="pre">#define</span></code>), and more. The goal of preprocessing is to reduce
duplicated code.</p>
<p>For instance, to call the PROS API, all of the <em>function declarations</em>
need to go in the source file. Using a <em>header file</em> can simplify this
operation by writing all of the function declarations in one place, and
just <code class="docutils literal notranslate"><span class="pre">#include</span></code>-ing it to reference those function declarations.</p>
<ol class="arabic simple" start="2">
<li>Compilation</li>
</ol>
<p>The next stage of compilation is to translate preprocessed code into
<em>assembly instructions</em> that the ARM Cortex-M3 processor can almost
understand. Assembly code is human readable and reasonably converted
into a language that the processor can understand.</p>
<ol class="arabic simple" start="3">
<li>Assembly</li>
</ol>
<p>The assembler translates assembly instructions directly into machine
code (called <em>object code</em> or <em>objects</em>). These files aren’t considered
human readable and can be interpreted by the processor directly.</p>
<ol class="arabic simple" start="4">
<li>Linking</li>
</ol>
<p>The final stage of compilation is linking. Objects contain pieces of
machine instructions, but may not be complete. For instance, when
compiling your source files, the PROS API are not directly incorporated
into your object code (merely references to the PROS API functions, as
specified by the function declarations). The Linker will incorporate and
rearrange all the difference object files (and libraries) into one file
that <em>can</em> be interpreted by the processor.</p>
<p>To compile code within Atom, press <code class="docutils literal notranslate"><span class="pre">Ctrl</span></code> + <code class="docutils literal notranslate"><span class="pre">Shift</span></code> + <code class="docutils literal notranslate"><span class="pre">P</span></code> to
bring up the Command Palette. You can start typing the command you wish
to execute, “Build: Trigger”. You should also notice that it will
display the available shortcut keys to execute the command. By default,
triggering a build can be done by pressing
<code class="docutils literal notranslate"><span class="pre">Ctrl</span></code> + <code class="docutils literal notranslate"><span class="pre">Alt</span></code> + <code class="docutils literal notranslate"><span class="pre">B</span></code> (<code class="docutils literal notranslate"><span class="pre">⌘</span></code> + <code class="docutils literal notranslate"><span class="pre">Alt</span></code> + <code class="docutils literal notranslate"><span class="pre">B</span></code>) or <code class="docutils literal notranslate"><span class="pre">F9</span></code>.
If you have unsaved files, Build will prompt you to save those files.
You should always save before building.</p>
<img alt="../_images/build.png" src="../_images/build.png" />
</div>
<div class="section" id="uploading-code-to-the-cortex">
<h3>Uploading Code to the Cortex<a class="headerlink" href="#uploading-code-to-the-cortex" title="Permalink to this headline">¶</a></h3>
<p>Now that you have compiled a binary file that the Cortex can understand,
you need to upload it to the microcontroller. Within Atom, click the
‘Upload to Cortex’ button in Atom. This process will upload the binary
the compilation process created (<code class="docutils literal notranslate"><span class="pre">bin/output.bin</span></code>) to the Cortex and
begin running it.</p>
<p>If you followed these instructions correctly, you can connect a joystick
to the clawbot and drive it using arcade controls!</p>
<img alt="../_images/upload.png" src="../_images/upload.png" />
</div>
<div class="section" id="subsystem-module-methodology">
<h3>Subsystem Module Methodology<a class="headerlink" href="#subsystem-module-methodology" title="Permalink to this headline">¶</a></h3>
<p>In this section, we’ll introduce the subsystem module methodology. When
developing code for complicated robotic systems, it’s extremely helpful
to abstract away the necessary steps to perform actions on a system. For
instance, to set the speed of a 4 motor chassis, you may need to set the
speed of the front left motor, the rear left motor, and so on. You might
just have four <code class="docutils literal notranslate"><span class="pre">motorSet()</span></code> calls every time you want to set robot’s
speed, but what happens when you add another pair of motors to your
chassis, or collapse your left and right sides onto two Y-cables? You
would need to comb through all of your code to find all of the times you
set the chassis speeds and adjust those calls accordingly. Similarly,
you may want a level of abstraction for getting sensor values - what
happens if you decide to switch from quadrature encoders to integrated
motor encoders?</p>
<p>Writing a function such as <code class="docutils literal notranslate"><span class="pre">chassisSet()</span></code> can help mitigate this
problem. Additionally, you cannot write your <code class="docutils literal notranslate"><span class="pre">chassisSet()</span></code> function
in multiple source files, so you need to create a single source file and
be able to incorporate it with <code class="docutils literal notranslate"><span class="pre">opcontrol.c</span></code>, <code class="docutils literal notranslate"><span class="pre">init.c</span></code>, and
<code class="docutils literal notranslate"><span class="pre">auto.c</span></code>. The subsystem module methodology is a standard way of
organizing these sorts of functions. We define a subsystem as a major
component of a robot: chassis, lift, intake, and claw are some common
subsystems. We’ll write our abstracted subsystem functions in a file
like <code class="docutils literal notranslate"><span class="pre">src/chassis.c</span></code> and put our function declarations in
<code class="docutils literal notranslate"><span class="pre">include/chassis.h</span></code> so that way we can call our new functions.</p>
<p>Let’s modify our existing operator control to use the subsystem
methodology. We’ll begin by creating the header file containing our
function declarations. You can create a new file in the <code class="docutils literal notranslate"><span class="pre">include</span></code>
directory by right clicking <code class="docutils literal notranslate"><span class="pre">include</span></code> and clicking “New File”. We’ll
name our file <code class="docutils literal notranslate"><span class="pre">chassis.h</span></code>. A new empty file is created for us. Header
files contain declarations, but not typically definitions. They are a
way to describe what resources are available to you.</p>
<p>Your own header files contain declarations for interfaces between
the source files of your program. Each time you have a group of
related declarations and macro definitions all or most of which are
needed in several different source files, it is a good idea to
create a header file for them.
<em>(`GNU &lt;https://gcc.gnu.org/onlinedocs/cpp/Header-Files.html&gt;`__)</em></p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="cp">#ifndef _CHASSIS_H_</span>
<span class="cp">#define _CHASSIS_H_</span>

<span class="c1">// Sets the speeds of the left and right wheels of the chassis</span>
<span class="kt">void</span> <span class="nf">chassisSet</span><span class="p">(</span><span class="kt">int</span> <span class="n">left</span><span class="p">,</span> <span class="kt">int</span> <span class="n">right</span><span class="p">);</span>

<span class="cp">#endif </span><span class="c1">// _CHASSIS_H_</span>
</pre></div>
</div>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="cp">#include</span> <span class="cpf">&quot;main.h&quot;    // includes API.h and other headers</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&quot;chassis.h&quot; // redundant, but ensures that the corresponding header file (chassis.h) is included</span><span class="cp"></span>

<span class="kt">void</span> <span class="nf">chassisSet</span><span class="p">(</span><span class="kt">int</span> <span class="n">left</span><span class="p">,</span> <span class="kt">int</span> <span class="n">right</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">motorSet</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">left</span><span class="p">);</span>
  <span class="n">motorSet</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="n">right</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Using this methodology, we can rewrite our operator control to something
much more concise:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="cp">#include</span> <span class="cpf">&quot;main.h&quot;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&quot;chassis.h&quot;</span><span class="cp"></span>

<span class="kt">void</span> <span class="nf">opcontrol</span><span class="p">()</span> <span class="p">{</span>
  <span class="k">while</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
    <span class="kt">int</span> <span class="n">power</span><span class="p">,</span> <span class="n">turn</span><span class="p">;</span>
    <span class="k">while</span> <span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">power</span> <span class="o">=</span> <span class="n">joystickGetAnalog</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span> <span class="c1">// vertical axis on left joystick</span>
      <span class="n">turn</span>  <span class="o">=</span> <span class="n">joystickGetAnalog</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span> <span class="c1">// horizontal axis on left joystick</span>
      <span class="n">chassisSet</span><span class="p">(</span><span class="n">power</span> <span class="o">+</span> <span class="n">turn</span><span class="p">,</span> <span class="n">power</span> <span class="o">-</span> <span class="n">turn</span><span class="p">);</span>
      <span class="n">delay</span><span class="p">(</span><span class="mi">20</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>It should be clear that congregating similar pieces of code into a C
source file and a header file for other source files simplifies and
organizes your code.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">You can modify <code class="docutils literal notranslate"><span class="pre">main.h</span></code> and
include your own header files. In our example, we could modify our
<code class="docutils literal notranslate"><span class="pre">main.h</span></code> to look like the following:</p>
</div>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="c1">// top of main.h omitted</span>
<span class="cp">#ifndef MAIN_H_</span>

<span class="c1">// This prevents multiple inclusion, which isn&#39;t bad for this file but is good practice</span>
<span class="cp">#define MAIN_H_</span>

<span class="cp">#include</span> <span class="cpf">&lt;API.h&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&quot;chassis.h&quot; // Added this line</span><span class="cp"></span>

<span class="c1">// rest of main.h omitted from this listing</span>
</pre></div>
</div>
<p>Then, in <code class="docutils literal notranslate"><span class="pre">opcontrol.c</span></code>, the only file we would need to <code class="docutils literal notranslate"><span class="pre">#include</span></code> is
<code class="docutils literal notranslate"><span class="pre">main.h</span></code>. In future source files, we would only ever need to
<code class="docutils literal notranslate"><span class="pre">#include</span> <span class="pre">&quot;main.h&quot;</span></code> in order to get access to all of our robot’s
subsystems’ functions!</p>
</div>
<div class="section" id="programming-the-vex-claw">
<h3>Programming the VEX Claw<a class="headerlink" href="#programming-the-vex-claw" title="Permalink to this headline">¶</a></h3>
<p>We now want to use the left horizontal joystick to control the aperture
of the claw. We’ll continue using the modular methodology:</p>
<p><code class="docutils literal notranslate"><span class="pre">include/claw.h</span></code>:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="cp">#ifndef *CLAW_H*</span>
<span class="cp">#define *CLAW_H*</span>

<span class="kt">void</span> <span class="nf">clawSet</span><span class="p">(</span><span class="kt">int</span> <span class="n">speed</span><span class="p">);</span>

<span class="cp">#endif</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">src/claw.c</span></code>:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="cp">#include</span> <span class="cpf">&quot;main.h&quot;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&quot;claw.h&quot;</span><span class="cp"></span>

<span class="kt">void</span> <span class="nf">clawSet</span><span class="p">(</span><span class="kt">int</span> <span class="n">speed</span><span class="p">)</span> <span class="p">{</span> <span class="n">motorSet</span><span class="p">(</span><span class="mi">9</span><span class="p">,</span> <span class="o">-</span><span class="n">speed</span><span class="p">);</span> <span class="p">}</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">src/opcontrol.c</span></code>:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="cp">#include</span> <span class="cpf">&quot;main.h&quot;</span><span class="cp"></span>

<span class="kt">void</span> <span class="nf">operatorControl</span><span class="p">()</span> <span class="p">{</span>
  <span class="kt">int</span> <span class="n">power</span><span class="p">,</span> <span class="n">turn</span><span class="p">;</span>
  <span class="k">while</span> <span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">power</span> <span class="o">=</span> <span class="n">joystickGetAnalog</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span> <span class="c1">// vertical axis on left joystick</span>
    <span class="n">turn</span> <span class="o">=</span> <span class="n">joystickGetAnalog</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span> <span class="c1">// horizontal axis on left joystick</span>
    <span class="n">chassisSet</span><span class="p">(</span><span class="n">power</span> <span class="o">+</span> <span class="n">turn</span><span class="p">,</span> <span class="n">power</span> <span class="o">-</span> <span class="n">turn</span><span class="p">);</span>

    <span class="c1">// add the following line:</span>
    <span class="n">clawSet</span><span class="p">(</span><span class="n">joystickGetAnalog</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">));</span>

    <span class="n">delay</span><span class="p">(</span><span class="mi">20</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="controlling-the-lift">
<h3>Controlling the Lift<a class="headerlink" href="#controlling-the-lift" title="Permalink to this headline">¶</a></h3>
<p>Our drivers requested that they be able to use the trigger buttons to
control the lift. At this point, complete the lift submodule on your own
just like we did for the chassis and claw. If you’re having trouble,
take a look at the complete Clawbot code sample at the bottom of this
page.</p>
<p><code class="docutils literal notranslate"><span class="pre">src/opcontrol.c</span></code>:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="cp">#include</span> <span class="cpf">&quot;main.h&quot;</span><span class="cp"></span>

<span class="kt">void</span> <span class="nf">operatorControl</span><span class="p">()</span> <span class="p">{</span>
  <span class="kt">int</span> <span class="n">power</span><span class="p">,</span> <span class="n">turn</span><span class="p">;</span>
  <span class="k">while</span> <span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">power</span> <span class="o">=</span> <span class="n">joystickGetAnalog</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span> <span class="c1">// vertical axis on left joystick</span>
    <span class="n">turn</span> <span class="o">=</span> <span class="n">joystickGetAnalog</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span> <span class="c1">// horizontal axis on left joystick</span>
    <span class="n">chassisSet</span><span class="p">(</span><span class="n">power</span> <span class="o">+</span> <span class="n">turn</span><span class="p">,</span> <span class="n">power</span> <span class="o">-</span> <span class="n">turn</span><span class="p">);</span>

    <span class="n">clawSet</span><span class="p">(</span><span class="n">joystickGetAnalog</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">));</span>

    <span class="c1">// add the following logic:</span>
    <span class="k">if</span><span class="p">(</span><span class="n">joystickGetDigital</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="n">JOY_UP</span><span class="p">))</span> <span class="p">{</span>
      <span class="n">liftSet</span><span class="p">(</span><span class="mi">127</span><span class="p">);</span> <span class="c1">// pressing up, so lift should go up</span>
    <span class="p">}</span>
    <span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="n">joystickGetDigital</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="n">JOY_DOWN</span><span class="p">))</span> <span class="p">{</span>
      <span class="n">liftSet</span><span class="p">(</span><span class="o">-</span><span class="mi">127</span><span class="p">);</span> <span class="c1">// pressing down, so lift should go down</span>
    <span class="p">}</span>
    <span class="k">else</span> <span class="p">{</span>
      <span class="n">liftSet</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span> <span class="c1">// no buttons are pressed, stop the lift</span>
    <span class="p">}</span>

    <span class="n">delay</span><span class="p">(</span><span class="mi">20</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Depending on your motor, you may notice that the arm falls back down
when stopped mid-raise. This can be alleviated by applying some power to
the motor when no buttons are pressed (instead of 0), or by using a
feedback control system such as PID.</p>
<p>-Congratulations, you have completed your first PROS program!</p>
</div>
</div>
</div>


           </div>
           <div class="articleComments">
            
           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="coding-faq.html" class="btn btn-neutral float-right" title="Coding FAQ" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="analog.html" class="btn btn-neutral" title="Analog Sensors" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2018, Purdue ACM SIGBots. Released under the MPL 2.0 license.

    </p>
  </div> 

</footer>

        </div>
      </div>

    </section>

  </div>
  

  <div class="rst-versions" data-toggle="rst-versions" role="note" aria-label="versions">
    <span class="rst-current-version" data-toggle="rst-current-version">
      <span class="fa fa-book"> Versions: </span>
      v: Cortex (2.12.1)
      <span class="fa fa-caret-down"></span>
    </span>
    <div class="rst-other-versions">
      <dl>
        <dt>Versions</dt>
        
          <dd><a href="../../v5/index.html">V5</a></dd>
        
          <dd><a href="../index.html">Cortex</a></dd>
        
      </dl>
    </div>
  </div>


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../',
            VERSION:'2.12.1',
            LANGUAGE:'None',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="../_static/jquery.js"></script>
      <script type="text/javascript" src="../_static/underscore.js"></script>
      <script type="text/javascript" src="../_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
  
 
<script type="text/javascript">
var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
</script>
<script type="text/javascript">
try {
var pageTracker = _gat._getTracker("UA-84548828-3");
pageTracker._trackPageview();
} catch(err) {}</script>


</body>
</html>