

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Tasks &mdash; PROS for Cortex 2.12.2 documentation</title>
  

  
  
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
  
  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  

<link rel="stylesheet" href="../_static/pygments.css" type="text/css" />

  

  
        <link rel="index" title="Index"
              href="../genindex.html"/>
        <link rel="search" title="Search" href="../search.html"/>
    <link rel="top" title="PROS for Cortex 2.12.2 documentation" href="../index.html"/>
        <link rel="up" title="Tutorials" href="index.html"/>
        <link rel="next" title="Ultrasonics" href="ultrasonic.html"/>
        <link rel="prev" title="Speaker" href="speaker.html"/>
   

  
  <script src="../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../index.html" class="icon icon-home"> PROS for Cortex
          

          
            
            <img src="../_static/logo.svg" class="logo" />
          
          </a>

          
            
            
              <div class="version">
                
                  Cortex (2.12.2)
                
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Home</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../index.html">PROS: Documentation Home</a></li>
</ul>
<p class="caption"><span class="caption-text">Getting Started</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../getting-started/index.html">Getting Started</a></li>
</ul>
<p class="caption"><span class="caption-text">Tutorials</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Tutorials</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="analog.html">Analog Sensors</a></li>
<li class="toctree-l2"><a class="reference internal" href="clawbot.html">Clawbot Tutorial</a></li>
<li class="toctree-l2"><a class="reference internal" href="coding-faq.html">Coding FAQ</a></li>
<li class="toctree-l2"><a class="reference internal" href="debugging.html">Debugging</a></li>
<li class="toctree-l2"><a class="reference internal" href="digitalRead.html">Digital Sensors</a></li>
<li class="toctree-l2"><a class="reference internal" href="encoders.html">Encoders</a></li>
<li class="toctree-l2"><a class="reference internal" href="i2c.html">I2C</a></li>
<li class="toctree-l2"><a class="reference internal" href="jinx.html">JINX Debugger</a></li>
<li class="toctree-l2"><a class="reference internal" href="known-issues.html">Known Issues</a></li>
<li class="toctree-l2"><a class="reference internal" href="lcd.html">LCD</a></li>
<li class="toctree-l2"><a class="reference internal" href="libraries.html">Libraries</a></li>
<li class="toctree-l2"><a class="reference internal" href="pneumatics.html">Pneumatics</a></li>
<li class="toctree-l2"><a class="reference internal" href="project-structure.html">Project Structure</a></li>
<li class="toctree-l2"><a class="reference internal" href="speaker.html">Speaker</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Tasks</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#introduction">Introduction</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#periodic-functions">Periodic functions</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#best-task-practices">Best Task Practices</a></li>
<li class="toctree-l3"><a class="reference internal" href="#synchronization">Synchronization</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="ultrasonic.html">Ultrasonics</a></li>
<li class="toctree-l2"><a class="reference internal" href="upgrading.html">Upgrading PROS</a></li>
<li class="toctree-l2"><a class="reference internal" href="uploading.html">Uploading</a></li>
</ul>
</li>
</ul>
<p class="caption"><span class="caption-text">API</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../api/index.html">API</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">PROS for Cortex</a>
        
      </nav>


      <div class="wy-nav-content">
        <div class="rst-content">
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
          <li><a href="index.html">Tutorials</a> &raquo;</li>
        
      <li>Tasks</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            
              <a href="https://github.com/purduesigbots/pros-docs/blob/master/cortex/tutorials/tasks.rst" class="fa fa-github"> Edit on GitHub</a>
            
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="tasks">
<h1>Tasks<a class="headerlink" href="#tasks" title="Permalink to this headline">¶</a></h1>
<div class="section" id="introduction">
<h2>Introduction<a class="headerlink" href="#introduction" title="Permalink to this headline">¶</a></h2>
<p>Tasks are a great tool to do multiple things at once, but they can be
difficult to use properly. Each task has a <em>priority</em> and a <em>stack
size</em>. The higher the priority, the more crucial the task is considered,
and more CPU time will be awarded to the task. Tasks of higher priority
will <em>always</em> run in preference to lower priority tasks, unless the
higher priority task is using <code class="docutils literal notranslate"><span class="pre">delay()</span></code> or some other waiting action.</p>
<p>Tasks are creating using <code class="docutils literal notranslate"><span class="pre">taskCreate()</span></code>, which invokes a user function
in the new task:</p>
<div class="code c highlight-c notranslate"><div class="highlight"><pre><span></span><span class="kt">void</span> <span class="nf">myFirstTask</span><span class="p">(</span><span class="kt">void</span> <span class="o">*</span> <span class="n">parameter</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">while</span><span class="p">(</span><span class="nb">true</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">&quot;Hello from another task!</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
    <span class="n">delay</span><span class="p">(</span><span class="mi">500</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">initialize</span><span class="p">()</span> <span class="p">{</span> <span class="c1">// or some other function</span>
  <span class="n">TaskHandle</span> <span class="n">firstTaskHandle</span> <span class="o">=</span> <span class="n">taskCreate</span><span class="p">(</span><span class="n">myFirstTask</span><span class="p">,</span> <span class="n">TASK_DEFAULT_STACK_SIZE</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="n">TASK_PRIORITY_DEFAULT</span><span class="p">);</span>
  <span class="n">delay</span><span class="p">(</span><span class="mi">20000</span><span class="p">);</span> <span class="c1">// or doing anything else</span>
  <span class="n">taskDelete</span><span class="p">(</span><span class="n">firstTaskHandle</span><span class="p">);</span> <span class="c1">// stop running the task</span>
<span class="p">}</span>
</pre></div>
</div>
<div class="section" id="periodic-functions">
<h3>Periodic functions<a class="headerlink" href="#periodic-functions" title="Permalink to this headline">¶</a></h3>
<p>If you want a function to run every <em>n</em> milliseconds, you can use
<code class="docutils literal notranslate"><span class="pre">taskRunLoop</span></code>. The example above can be implemented slightly
differently and receive the same effect:</p>
<div class="code c highlight-c notranslate"><div class="highlight"><pre><span></span><span class="kt">void</span> <span class="nf">myFirstRunLoop</span><span class="p">()</span> <span class="p">{</span>
  <span class="n">printf</span><span class="p">(</span><span class="s">&quot;Hello from another task!</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">initialize</span><span class="p">()</span> <span class="p">{</span>
  <span class="n">TaskHandle</span> <span class="n">secondTaskHandle</span> <span class="o">=</span> <span class="n">taskRunLoop</span><span class="p">(</span><span class="n">myFirstRunLoop</span><span class="p">,</span> <span class="mi">500</span><span class="p">);</span>
  <span class="n">delay</span><span class="p">(</span><span class="mi">20000</span><span class="p">);</span> <span class="c1">// or doing anything else</span>
  <span class="n">taskDelete</span><span class="p">(</span><span class="n">secondTaskHandle</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="best-task-practices">
<h2>Best Task Practices<a class="headerlink" href="#best-task-practices" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li>Limit the number of tasks; five medium sized tasks will run quicker
than ten tiny ones. There is also a limit of twelve tasks running at
once.</li>
<li>Tasks are usually not automatically stopped if the robot is disabled,
unlike <code class="docutils literal notranslate"><span class="pre">operatorControl</span></code> and <code class="docutils literal notranslate"><span class="pre">autonomous</span></code>. Tasks running while
disabled cannot use the VEX Joystick or VEX Motors. If the task
should stop when the robot is disabled, use the <code class="docutils literal notranslate"><span class="pre">isOnline</span></code> and/or
the <code class="docutils literal notranslate"><span class="pre">isAutonomous</span></code> function to control the program accordingly. If
<code class="docutils literal notranslate"><span class="pre">taskRunLoop</span></code> is used, the task will automatically be cancelled if
the robot is disabled or switched between driver and autonomous.</li>
<li>Most tasks should have a priority from <code class="docutils literal notranslate"><span class="pre">TASK_PRIORITY_LOWEST</span> <span class="pre">+</span> <span class="pre">1</span></code>
to <code class="docutils literal notranslate"><span class="pre">TASK_PRIORITY_HIGHEST</span> <span class="pre">-</span> <span class="pre">1</span></code>. Tasks of the lowest or highest
priority may cause unexpected behavior.</li>
<li>Tasks should wait when there is no work to do so other tasks can run.
If a task, especially a high-priority one, does not occasionally use
delay or similar, other tasks may not run or run very slowly. Since
hardware such as the VEX LCD and Integrated Motor Encoders is also
updated by tasks, a run away task can cause unexpected behavior.</li>
<li>The Cortex Microcontroller is very fast. It is unlikely that any
repetitive task will gain from running continuously. Even in the
fastest scenarios, <code class="docutils literal notranslate"><span class="pre">delay(2)</span></code> will probably make no noticeable
difference, but will prevent future task starvation issues.</li>
<li>Tasks using motors or joysticks should use <code class="docutils literal notranslate"><span class="pre">delay(20)</span></code> as the
motors and joysticks are only updated every 20 ms.</li>
</ul>
</div>
<div class="section" id="synchronization">
<h2>Synchronization<a class="headerlink" href="#synchronization" title="Permalink to this headline">¶</a></h2>
<p>One problem which one often runs into when dealing with tasks is the
problem of synchronization. If two tasks try to read the same sensor or
control the same motor at the same time, unexpected behavior may occur
since two tasks are trying to read/write to the same piece of data.</p>
<p>Tasks can be designed to never conflict over motors or sensors:
(division of responsibility)</p>
<div class="code c highlight-c notranslate"><div class="highlight"><pre><span></span><span class="kt">void</span> <span class="nf">Task1</span><span class="p">(</span><span class="kt">void</span> <span class="o">*</span> <span class="n">ignore</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// update motors 2 and 4</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">Task2</span><span class="p">(</span><span class="kt">void</span> <span class="o">*</span> <span class="n">ignore</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// update motors 5 and 6</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Sometimes this is impossible: suppose you wanted to write a PID
controller on its own task and you wanted to change the target of the
controller. PROS features two types of synchronization structures,
<em>mutexes</em> and <em>semaphores</em> that can be used to coordinate tasks. Mutexes
stand for mutual exclusion; only one task can hold a mutex at any given
time. Other tasks must wait for the first task to finish (and release
the mutex) before they may continue.</p>
<div class="code c highlight-c notranslate"><div class="highlight"><pre><span></span><span class="n">Mutex</span> <span class="n">mutex</span> <span class="o">=</span> <span class="n">mutexCreate</span><span class="p">();</span>

<span class="c1">// Acquire the mutex; other tasks using this command will wait until the mutex is released</span>
<span class="c1">// timeout can specify the maximum time to wait, or -1 to wait forever</span>
<span class="c1">// If the timeout expires, &quot;false&quot; will be rturned, otherwise &quot;true&quot;</span>
<span class="n">mutexTake</span><span class="p">(</span><span class="n">mutex</span><span class="p">,</span> <span class="n">timeout</span><span class="p">);</span>
<span class="c1">// do some work</span>
<span class="c1">// Release the mutex for other tasks</span>
<span class="n">mutexGive</span><span class="p">(</span><span class="n">mutex</span><span class="p">);</span>
</pre></div>
</div>
<p>Semaphores are like signals - one task can take a semaphore to wait for
a coordination signal from another task which gives the semaphore.
Multiple tasks may wait for a semaphore; if this is the case, the
highest priority task will continue per signal given.</p>
<div class="code c highlight-c notranslate"><div class="highlight"><pre><span></span><span class="c1">// Create a semaphore</span>
<span class="n">Semaphore</span> <span class="n">semaphore</span> <span class="o">=</span> <span class="n">semaphoreCreate</span><span class="p">();</span>

<span class="c1">// Waits for the semaphore to be signalled</span>
<span class="c1">// timeout can specify the maximum time to wait, or MAX_DELAY to wait forever</span>
<span class="c1">// If the timeout expires, &quot;false&quot; will be rturned, otherwise &quot;true&quot;</span>
<span class="n">semaphoreTake</span><span class="p">(</span><span class="n">semaphore</span><span class="p">);</span>
<span class="c1">// do something</span>
<span class="c1">// Signal the semaphore</span>
<span class="n">semaphoreGive</span><span class="p">(</span><span class="n">semaphore</span><span class="p">);</span>
</pre></div>
</div>
</div>
</div>


           </div>
           <div class="articleComments">
            
           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="ultrasonic.html" class="btn btn-neutral float-right" title="Ultrasonics" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="speaker.html" class="btn btn-neutral" title="Speaker" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2018, Purdue ACM SIGBots. Released under the MPL 2.0 license

    </p>
  </div> 

</footer>

        </div>
      </div>

    </section>

  </div>
  

  <div class="rst-versions" data-toggle="rst-versions" role="note" aria-label="versions">
    <span class="rst-current-version" data-toggle="rst-current-version">
      <span class="fa fa-book"> Versions: </span>
      v: Cortex (2.12.2)
      <span class="fa fa-caret-down"></span>
    </span>
    <div class="rst-other-versions">
      <dl>
        <dt>Versions</dt>
        
          <dd><a href="../../v5/index.html">V5</a></dd>
        
          <dd><a href="../index.html">Cortex</a></dd>
        
      </dl>
    </div>
  </div>


  

    
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../_static/jquery.js"></script>
        <script type="text/javascript" src="../_static/underscore.js"></script>
        <script type="text/javascript" src="../_static/doctools.js"></script>
    

  

  <script type="text/javascript" src="../_static/js/theme.js"></script>

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
  
 
<script type="text/javascript">
var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
</script>
<script type="text/javascript">
try {
var pageTracker = _gat._getTracker("UA-84548828-3");
pageTracker._trackPageview();
} catch(err) {}</script>


</body>
</html>